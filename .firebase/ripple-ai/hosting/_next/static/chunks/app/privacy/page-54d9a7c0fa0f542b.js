(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[385,953,327],{8693:function(e,t,r){Promise.resolve().then(r.bind(r,6872))},6872:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var s=r(7437),o=r(2265),n=r(1396),a=r.n(n);r(5425);var i=r(4008),c=r(4033),l=r(4032),u=r(8872);class d{async getUserData(e,t){if(console.log({user_id:e}),void 0!=e)try{let r=await (0,u.Z)({url:l.T5+l.F4+"/"+e,method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer "+t}});if(r&&r.data)return r;throw console.error("Invalid response:",r),Error("Invalid response from the server")}catch(e){throw console.error("Error fetching user data:",e),e}}constructor(){this.getUserData=this.getUserData.bind(this)}}var h=new d,f=()=>{let{state:e,dispatch:t}=(0,i.useGlobalState)(),[r,n]=(0,o.useState)(),[l,u]=(0,o.useState)(e.user);return(0,o.useEffect)(()=>{let t=0;e.user&&(t=e.user.user_id),console.log({user_id:r,num:t})},[]),(0,o.useEffect)(()=>{if(0!=r){let t=async()=>{console.log(e);let t=await h.getUserData(r,e.user.access_token);u(t.data),console.log(t.data)};t().catch(console.error)}},[r]),(0,c.useRouter)(),(0,s.jsx)("nav",{className:"bg-zinc-800 p-4 fixed w-full z-50",children:(0,s.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,s.jsxs)(a(),{href:"/",className:"text-white text-5xl font-bold",children:["RiPPLE.",(0,s.jsx)("span",{style:{color:"orange"},children:"ai"})]}),e.user?(0,s.jsx)("div",{}):(0,s.jsx)(s.Fragment,{}),(0,s.jsxs)("div",{className:"space-x-8",children:[(0,s.jsx)(a(),{href:"/stories",className:"text-white hover:text-gray-300",children:"Stories"}),(0,s.jsx)(a(),{href:"/submissions",className:"text-white hover:text-gray-300",children:"Submissions"}),(0,s.jsx)(a(),{href:"/login",className:"text-white hover:text-gray-300",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z"})})})]})]})})}},4008:function(e,t,r){"use strict";r.r(t),r.d(t,{GlobalStateProvider:function(){return c},useGlobalState:function(){return l}});var s=r(7437),o=r(2265);let n={user:null},a=(0,o.createContext)();function i(e,t){switch(t.type){case"SET_USER":return{...e,user:t.payload};case"LOGOUT_USER":return{...e,user:null};default:return e}}function c(e){let{children:t}=e,[r,c]=(0,o.useReducer)(i,n);return(0,s.jsx)(a.Provider,{value:{state:r,dispatch:c},children:t})}function l(){return(0,o.useContext)(a)}},8872:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(2173),o=r(4032);let n=s.Z.create({baseURL:o.T5,headers:{"Content-Type":"application/x-www-form-urlencoded"}});n.interceptors.response.use(e=>e,e=>{let t=e.config;if(401===e.response.status&&t.url===o.T5+o.Q)return window.location.href="/login/",Promise.reject(e);if("token_not_valid"===e.response.data.code&&401===e.response.status&&"Unauthorized"===e.response.statusText){let e=localStorage.getItem("user");if(e){let r=JSON.parse(atob(e.refresh.split(".")[1])),s=Math.ceil(Date.now()/1e3);if(console.log(r.exp),r.exp>s)return n.post(o.Q,{refresh:e.refresh}).then(e=>(localStorage.setItem("user",e.data),n.defaults.headers.Authorization="Bearer "+e.data.access,t.headers.Authorization="Bearer "+e.data.access,n(t))).catch(e=>{console.log(e)});console.log("Refresh token is expired",r.exp,s),window.location.href="/login/"}else console.log("Refresh token not available."),window.location.href="/login/"}return Promise.reject(e)});var a=e=>n({...e,headers:function(){let e={"Content-Type":"application/x-www-form-urlencoded"},t=JSON.parse(localStorage.getItem("user"));return t&&t.access&&(e.Authorization="Bearer "+t.access),e}()}).then(e=>(console.debug("Request Successful!",e),e)).catch(e=>(console.error("Request Failed:",e.config),e.response?(console.error("Status:",e.response.status),console.error("Data:",e.response.data),console.error("Headers:",e.response.headers)):console.error("Error Message:",e.message),Promise.reject(e.response||e.message)))},4032:function(e,t,r){"use strict";r.d(t,{F4:function(){return i},LW:function(){return o},Q:function(){return a},T5:function(){return s},bc:function(){return n}});let s="https://8000-tresphill-rippleai2-gwyip31yybf.ws-us106.gitpod.io/api/v1/",o="login/access-token",n="users/register/",a="token/refresh/",i="users"},5425:function(e,t,r){"use strict";var s=r(4032),o=r(8872);class n{async login(e,t){try{let r=await (0,o.Z)({url:s.T5+s.LW,method:"POST",data:{username:e,password:t}});if(r.data.access_token)return this.setToken(r)}catch(e){return e.response}}logout(){localStorage.removeItem("user")}async register(e){let{username:t,email:r,password:n}=e;try{return await (0,o.Z)({url:s.T5+s.bc,method:"POST",data:{username:t,password:n,email:r}})}catch(e){return e.response}}setToken(e){return localStorage.setItem("user",JSON.stringify(e.data)),e.data}async refreshToken(){try{let e=JSON.parse(localStorage.getItem("user"));if(e.refresh){let t=await (0,o.Z)({url:s.Q,method:"POST",data:{refresh:e.refresh}});return t.data}}catch(e){return e.response}}constructor(){this.login=this.login.bind(this)}}t.Z=new n}},function(e){e.O(0,[879,971,472,744],function(){return e(e.s=8693)}),_N_E=e.O()}]);